<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Venus Workshop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      /* --- –¶–í–ï–¢–û–í–´–ï –°–•–ï–ú–´ (VENUS STYLE) --- */
      :root { 
        --bg-app: #F2F2F7;
        --bg-panel: linear-gradient(180deg, #FFFFFF 0%, #F5F7FA 100%);      
        --text-main: #1C1C1E;     
        --text-sub: #8E8E93;      
        --accent: #007AFF;        
        --border: rgba(0,0,0,0.08); 
        --border-strong: #C7C7CC;
        --input-bg: #FFFFFF;      
        
        --color-inc: #34C759;
        --color-exp: #FF3B30;     
        --color-prof: #5856D6;    
        --color-vis: #AF52DE;
        
        --danger: #FF3B30;
        --shadow-card: 0 4px 12px rgba(0,0,0,0.06);
        --radius: 20px;
        --scroll-thumb: #C7C7CC;
      }
      
      [data-theme="dark"] { 
        --bg-app: #0f172a;
        --bg-panel: #1e293b; 
        --text-main: #f8fafc;     
        --text-sub: #94a3b8;      
        --accent: #60a5fa;        
        --border: #334155;        
        --border-strong: #475569;
        --input-bg: #0f172a;      
        
        --shadow-card: 0 4px 20px rgba(0,0,0,0.4);
        --color-inc: #4ade80;     
        --color-exp: #f87171;     
        --color-prof: #818cf8;    
        --color-vis: #c084fc;     
        --scroll-thumb: #475569;
      }
      
      /* BASIC STYLES */
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background-color: var(--scroll-thumb); border-radius: 10px; }
      
      body { 
          margin: 0; padding: 20px; 
          font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
          background-color: var(--bg-app); color: var(--text-main); 
          height: 100vh; box-sizing: border-box; overflow: hidden; 
          display:flex; flex-direction:column;
          transition: background 0.3s; 
          -webkit-font-smoothing: antialiased;
          font-weight: 500;
      }
      
      /* HEADER */
      .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-shrink: 0; }
      .brand-box { display: flex; align-items: center; gap: 12px; }
      .title { margin: 0; font-size: 24px; font-weight: 800; color: var(--text-main); letter-spacing: -0.5px; }
      
      /* VENUS ICON */
      .venus-icon { width: 42px; height: 42px; cursor: pointer; transition: transform 0.5s ease; }
      .venus-icon:hover { transform: rotate(120deg) scale(1.1); }
      .venus-icon.spinning { animation: spinInfinite 1.5s linear infinite; }
      @keyframes spinInfinite { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

      /* THEME BTN */
      .theme-toggle-btn {
          width: 44px; height: 44px; border-radius: 50%; background: var(--bg-panel); 
          cursor: pointer; display: flex; align-items: center; justify-content: center; overflow: hidden;
          box-shadow: var(--shadow-card); position: relative; border: 1px solid var(--border);
      }
      .theme-icon { position: absolute; font-size: 22px; transition: 0.5s; user-select: none; }
      [data-theme="light"] .icon-sun { transform: rotate(0) scale(1); opacity:1; }
      [data-theme="light"] .icon-moon { transform: rotate(90deg) scale(0); opacity:0; }
      [data-theme="dark"] .icon-sun { transform: rotate(-90deg) scale(0); opacity:0; }
      [data-theme="dark"] .icon-moon { transform: rotate(0) scale(1); opacity:1; }

      /* NAV */
      .nav { display: flex; background: var(--bg-panel); padding: 4px; border-radius: 14px; margin-bottom: 20px; flex-shrink: 0; box-shadow: var(--shadow-card); border: 1px solid var(--border); }
      .nav-btn { flex: 1; padding: 10px; border: none; background: transparent; color: var(--text-sub); border-radius: 10px; cursor: pointer; font-weight: 600; text-align: center; transition: 0.2s; font-size: 14px; }
      .nav-btn.active { background: var(--bg-app); color: var(--text-main); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
      [data-theme="dark"] .nav-btn.active { background: #334155; box-shadow: none; }

      /* CONTENT */
      .content-area { flex: 1; position: relative; overflow: hidden; border-radius: var(--radius); display: flex; }
      .tab-page { display: none; width: 100%; height: 100%; }
      .tab-page.active { display: block; animation: fadeIn 0.4s; }
      
      .split-view { display: flex; height: 100%; gap: 20px; }
      .panel { background: var(--bg-panel); border-radius: var(--radius); box-shadow: var(--shadow-card); overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--border); }
      .panel-left { width: 360px; padding: 30px; flex-shrink: 0; overflow-y: auto; }
      .panel-right { flex: 1; }
      @media (max-width: 900px) { .split-view { flex-direction: column; overflow-y: auto; } .panel-left { width: auto; flex-shrink: 0; } .panel-right { height: 600px; flex-shrink: 0; } }

      /* INPUTS */
      h3 { margin-top: 0; font-size: 18px; font-weight: 700; color: var(--text-main); margin-bottom: 20px; }
      label { font-size: 12px; font-weight: 700; color: var(--text-sub); margin-bottom: 8px; display: block; }
      input, select { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border-strong); background-color: var(--input-bg); color: var(--text-main); font-size: 15px; box-sizing: border-box; outline:none; font-weight: 600; }
      .qty-wrapper { display: flex; align-items: center; background: var(--input-bg); border: 1px solid var(--border-strong); border-radius: 12px; overflow: hidden; padding: 2px; }
      .qty-btn { width: 44px; height: 44px; background: transparent; border: none; color: var(--text-main); font-size: 20px; cursor: pointer; border-radius: 10px; font-weight: 600; }
      .qty-input { text-align: center; border: none; font-weight: 700; font-size: 18px; flex: 1; padding: 0; background: transparent; color: var(--text-main); }
      
      .btn { width: 100%; padding: 18px; background: var(--accent); color: white; border: none; border-radius: 16px; font-weight: 700; cursor: pointer; margin-top: 20px; font-size: 16px; transition: 0.2s; }
      .btn:active { transform: scale(0.98); opacity: 0.9; }

      /* TABLE */
      .table-header { padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
      .btn-refresh { padding: 8px 16px; background: transparent; border: 1px solid var(--border-strong); border-radius: 8px; font-weight: 600; cursor: pointer; color: var(--text-main); font-size: 12px; }
      .grid-wrapper { flex: 1; overflow-y: auto; padding: 0 10px; }
      table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
      th { position: sticky; top: 0; background: var(--bg-panel); color: var(--text-sub); font-size: 11px; text-transform: uppercase; text-align: left; padding: 10px 20px; font-weight: 700; z-index: 10; }
      td { padding: 16px 20px; background: var(--input-bg); border: 1px solid var(--border); font-size: 14px; color: var(--text-main); font-weight: 500; }
      tr td:first-child { border-top-left-radius: 14px; border-bottom-left-radius: 14px; border-right: none; }
      tr td:last-child { border-top-right-radius: 14px; border-bottom-right-radius: 14px; text-align: right; border-left: none; }
      tr td:not(:first-child):not(:last-child) { border-left: none; border-right: none; }
      
      .btn-table { padding: 6px 14px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: 1px solid var(--border-strong); background: transparent; color: var(--text-sub); margin-left: 6px; }
      
      /* ANALYTICS */
      .analytics-container { padding: 0 10px 20px 10px; overflow-y: auto; height: 100%; box-sizing: border-box; }
      .filters-row { display: flex; gap: 15px; margin-bottom: 25px; }
      .filters-row select { flex: 1; width: 50%; }
      .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
      .kpi-card { background: var(--bg-panel); padding: 25px; border-radius: 24px; box-shadow: var(--shadow-card); border: 1px solid var(--border); }
      .kpi-title { font-size: 12px; color: var(--text-sub); text-transform: uppercase; font-weight: 700; margin-bottom: 8px; }
      .kpi-val { font-size: 32px; font-weight: 800; color: var(--text-main); }
      .kpi-trend { font-size: 13px; font-weight: 700; margin-top: 5px; display: inline-block; padding: 4px 10px; border-radius: 20px; }
      .trend-up { background: rgba(52, 199, 89, 0.15); color: var(--color-inc); }
      .trend-down { background: rgba(255, 59, 48, 0.15); color: var(--color-exp); }
      
      .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; margin-bottom: 25px; }
      .chart-box { background: var(--bg-panel); border-radius: 24px; padding: 25px; box-shadow: var(--shadow-card); display: flex; flex-direction: column; min-height: 320px; border: 1px solid var(--border); }
      
      /* SEARCH */
      .search-wrap { position: relative; margin-bottom: 15px; }
      .search-res { position: absolute; top: 100%; left: 0; width: 100%; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 14px; z-index: 100; max-height: 200px; overflow-y: auto; display: none; margin-top: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
      .res-item { padding: 14px 20px; cursor: pointer; border-bottom: 1px solid var(--border); font-size: 15px; color: var(--text-main); font-weight: 600; }
      
      /* MOBILE */
      @media (max-width: 768px) {
        body { padding: 10px; height: auto; min-height: 100vh; overflow: auto; }
        .kpi-grid { grid-template-columns: 1fr 1fr; }
        .charts-grid { grid-template-columns: 1fr; }
        .content-area, .tab-page { overflow: visible; height: auto; }
      }
      
      .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
      .modal-box { background: var(--bg-panel); padding: 25px; border-radius: 20px; width: 340px; }
      .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 24px; border-radius: 8px; opacity: 0; transition: 0.3s; z-index: 3000; }
      .toast.show { opacity: 1; bottom: 50px; }
      .toast.error { background: var(--danger); }
    </style>
</head>
<body data-theme="light">
    <div id="toast" class="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
    <div class="header">
        <div class="brand-box">
            <svg id="venus" class="venus-icon" viewBox="0 0 100 100" fill="none"><circle cx="50" cy="50" r="48" fill="url(#venusGrad)" /><defs><radialGradient id="venusGrad"><stop stop-color="#FFD700"/><stop offset="1" stop-color="#FF8C00"/></radialGradient></defs></svg>
            <div class="title">–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –í–µ–Ω–µ—Ä–∞</div>
        </div>
        <div class="theme-toggle-btn" onclick="toggleTheme(event)"><div class="theme-icon icon-sun">‚òÄÔ∏è</div><div class="theme-icon icon-moon">üåë</div></div>
    </div>
    <div class="nav">
        <button class="nav-btn active" onclick="switchTab('income')">–ú–∞—Å—Ç–µ—Ä –ö–ª–∞—Å—Å—ã</button>
        <button class="nav-btn" onclick="switchTab('expense')">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</button>
        <button class="nav-btn" onclick="switchTab('analytics')">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
    </div>
    <div class="content-area">
        <div id="splitTab" class="tab-page active">
           <div class="split-view">
                <div class="panel panel-left">
                    <h3 id="formTitle">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</h3>
                    <div class="search-wrap">
                        <label id="lblSearch">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="inpName" placeholder="–ü–æ–∏—Å–∫..." oninput="showSearch(event); calcTotal()">
                        <div class="search-res" id="searchRes"></div>
                    </div>
                    <div style="display:flex; gap:15px; margin-bottom:25px;">
                        <div style="flex:1"><label>–¶–µ–Ω–∞</label><div class="qty-wrapper"><input type="number" id="inpPrice" class="qty-input" placeholder="0" oninput="calcTotal()"></div></div>
                        <div style="flex:1"><label>–ö–æ–ª-–≤–æ</label><div class="qty-wrapper"><button class="qty-btn" onclick="modVal('inpQty', -1)">‚àí</button><input type="number" id="inpQty" class="qty-input" value="1" oninput="calcTotal()"><button class="qty-btn" onclick="modVal('inpQty', 1)">+</button></div></div>
                    </div>
                    <div style="text-align:center; margin-bottom:15px; padding: 20px; background: var(--input-bg); border-radius: 16px; border: 1px solid var(--border);">
                        <span style="font-size:12px; color:var(--text-sub); display:block; margin-bottom:5px;">–ò–¢–û–ì–û</span>
                        <div id="txtTotal" style="font-size:32px; font-weight:800; color:var(--text-main)">0 ‚ÇΩ</div>
                    </div>
                    <button id="btnAdd" class="btn" onclick="submitEntry()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                </div>
                <div class="panel panel-right">
                    <div class="table-header"><h3 id="tableTitle" style="margin:0">–ó–∞–ø–∏—Å–∏</h3><button class="btn-refresh" onclick="refreshTable(true)">–û–±–Ω–æ–≤–∏—Ç—å</button></div>
                    <div class="grid-wrapper">
                       <table id="mainTable">
                            <thead><tr><th>–î–∞—Ç–∞</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–°—É–º–º–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                        <div id="emptyMsg" style="padding:40px; text-align:center; color:var(--text-sub);">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            </div>
        </div>
        <div id="analyticsTab" class="tab-page">
            <div class="analytics-container">
                <div class="filters-row"><select id="anYear" onchange="loadAnalytics()"></select><select id="anMonth" onchange="loadAnalytics()"></select></div>
                <div class="kpi-grid">
                    <div class="kpi-card"><div class="kpi-title">–í–´–†–£–ß–ö–ê</div><div class="kpi-val" style="color:var(--color-inc)" id="kpiInc">0</div><div id="trendInc"></div></div>
                    <div class="kpi-card"><div class="kpi-title">–†–ê–°–•–û–î–´</div><div class="kpi-val" style="color:var(--color-exp)" id="kpiExp">0</div><div id="trendExp"></div></div>
                    <div class="kpi-card"><div class="kpi-title">–ü–†–ò–ë–´–õ–¨</div><div class="kpi-val" style="color:var(--color-prof)" id="kpiProf">0</div><div id="trendProf"></div></div>
                    <div class="kpi-card"><div class="kpi-title">–ü–û–°–ï–¢–ò–¢–ï–õ–ò</div><div class="kpi-val" style="color:var(--color-vis)" id="kpiVis">0</div><div id="trendVis"></div></div>
                </div>
                <div class="charts-grid">
                    <div class="chart-box"><div style="font-weight:700; margin-bottom:20px;">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ü—É–ª—å—Å</div><div style="flex:1"><canvas id="chartPulse"></canvas></div></div>
                    <div class="chart-box"><div style="font-weight:700; margin-bottom:20px;">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</div><div style="flex:1"><canvas id="chartAttendance"></canvas></div></div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="deleteModal" class="modal-overlay">
        <div class="modal-box">
            <h3>–£–¥–∞–ª–µ–Ω–∏–µ</h3><p>–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?</p>
            <div style="display:flex; gap:10px;"><button class="btn" style="background:var(--danger)" onclick="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button><button class="btn" style="background:var(--input-bg); color:var(--text-main); border:1px solid var(--border-strong)" onclick="document.getElementById('deleteModal').style.display='none'">–û—Ç–º–µ–Ω–∞</button></div>
        </div>
    </div>

    <script>
      // ===============================================
      // üëá –í–°–¢–ê–í–¨ –°–Æ–î–ê –ù–û–í–£–Æ –°–°–´–õ–ö–£ –ò–ó GOOGLE (DEPLOY ID)
      const GAS_URL = 'https://script.google.com/macros/s/AKfycbz8tnx1KtgIwjDI6depwtbcboMeWc1SXB47pry6Pu7T7ZTgzKbY2GSF82zfNoBQfSzs/exec';
      // ===============================================

      const IS_GOOGLE = typeof google !== 'undefined' && google.script && google.script.run;
      let currTab = 'income', dataCache = {}, config = {}, charts = {}, deleteTargetId = null;

      // üî• –ú–û–°–¢ (–ò–ó DASHBOARD.TXT) üî•
      async function runBackend(action, payload = {}) {
         if (IS_GOOGLE) {
             return new Promise((resolve, reject) => {
                 if(action === 'getInitialConfig') google.script.run.withSuccessHandler(resolve).withFailureHandler(reject).getInitialConfig();
                 else if(action === 'saveTransaction') google.script.run.withSuccessHandler(resolve).withFailureHandler(reject).saveTransaction(payload);
                 else if(action === 'getTableData') google.script.run.withSuccessHandler(resolve).withFailureHandler(reject).getTableData(payload.type);
                 else if(action === 'deleteTransaction') google.script.run.withSuccessHandler(resolve).withFailureHandler(reject).deleteTransaction(payload);
                 else if(action === 'getAnalyticsData') google.script.run.withSuccessHandler(resolve).withFailureHandler(reject).getAnalyticsData(payload.year, payload.monthIdx);
                 else reject("Unknown Func");
             });
         } else {
             if(GAS_URL.includes("–í–ê–®_")) { alert("–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –≤ index.html!"); throw new Error("No URL"); }
             payload.action = action; // –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏
             try {
                 const res = await fetch(GAS_URL, {
                     method: "POST",
                     headers: { "Content-Type": "text/plain;charset=utf-8" },
                     body: JSON.stringify(payload)
                 });
                 const text = await res.text();
                 try { return JSON.parse(text); } 
                 catch(e) { throw new Error("Server Error: " + text); }
             } catch(e) { throw e; }
         }
      }

      window.onload = function() {
          if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.expand();
          runBackend('getInitialConfig').then(res => {
              config = res;
              const ySel = document.getElementById('anYear'); ySel.innerHTML=''; res.years.forEach(y=>ySel.add(new Option(y,y)));
              const mSel = document.getElementById('anMonth'); mSel.innerHTML=''; mSel.add(new Option('–í–µ—Å—å –≥–æ–¥','all')); res.months.forEach((m,i)=>mSel.add(new Option(m,i))); mSel.value=new Date().getMonth();
              refreshTable(true);
              loadAnalytics();
          }).catch(e => showToast("Error: "+e, true));
      };

      function refreshTable(force) {
          if(!force && dataCache[currTab]) return;
          const tbody = document.getElementById('tableBody');
          tbody.innerHTML = ''; document.getElementById('emptyMsg').style.display='block';
          
          runBackend('getTableData', {type: currTab}).then(data => {
              dataCache[currTab] = data;
              renderTable(data);
          });
      }

      function renderTable(data) {
          const tbody = document.getElementById('tableBody');
          document.getElementById('emptyMsg').style.display = data.length ? 'none' : 'block';
          tbody.innerHTML = data.map(r => `
             <tr><td>${r.dateStr}</td><td><b>${r.name}</b></td><td>${r.total}</td>
             <td><button class="btn-table" onclick="openDel(${r.rowId})">–£–¥–∞–ª–∏—Ç—å</button></td></tr>
          `).join('');
      }

      function submitEntry() {
          const name = document.getElementById('inpName').value;
          const price = parseFloat(document.getElementById('inpPrice').value);
          const qty = parseFloat(document.getElementById('inpQty').value);
          if(!name || !price) return;
          
          const btn = document.getElementById('btnAdd'); btn.innerText = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...";
          runBackend('saveTransaction', {type: currTab, name, price, qty, total: price*qty, isNew: true})
            .then(res => {
                btn.innerText = "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å";
                if(res.success) { showToast("–£—Å–ø–µ—à–Ω–æ"); refreshTable(true); loadAnalytics(); }
                else showToast(res.message, true);
            });
      }

      function loadAnalytics() {
          const y = document.getElementById('anYear').value, m = document.getElementById('anMonth').value;
          runBackend('getAnalyticsData', {year: y, monthIdx: m}).then(d => {
             document.getElementById('kpiInc').innerText = d.current.income.toLocaleString();
             document.getElementById('kpiExp').innerText = d.current.expense.toLocaleString();
             document.getElementById('kpiProf').innerText = d.current.profit.toLocaleString();
             document.getElementById('kpiVis').innerText = d.current.visitors;
             
             renderChart('chartPulse', d.pulse.labels, [{label:'–î–æ—Ö–æ–¥', data:d.pulse.income, borderColor:'#34C759'}, {label:'–†–∞—Å—Ö–æ–¥', data:d.pulse.expense, borderColor:'#FF3B30'}]);
             renderChart('chartAttendance', d.attendance.labels, [{label:'–ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏', data:d.attendance.data, borderColor:'#AF52DE'}]);
          });
      }
      
      // Helpers
      function renderChart(id, l, ds) {
        if(charts[id]) charts[id].destroy();
        charts[id] = new Chart(document.getElementById(id), { type:'line', data:{labels:l, datasets:ds.map(d=>({...d, tension:0.4, fill:true, backgroundColor:d.borderColor+'15'}))}, options:{responsive:true, plugins:{legend:{display:false}}, scales:{x:{grid:{display:false}}, y:{display:false}}} });
      }
      function switchTab(t) { currTab = t; document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); document.querySelectorAll('.tab-page').forEach(p=>p.classList.remove('active')); if(t==='analytics'){document.getElementById('analyticsTab').classList.add('active'); loadAnalytics();}else{document.getElementById('splitTab').classList.add('active'); updateUI(t); refreshTable();} }
      function updateUI(t) { const isI = t==='income'; document.getElementById('formTitle').innerText = isI?'–î–æ–±–∞–≤–∏—Ç—å –ú–∞—Å—Ç–µ—Ä –ö–ª–∞—Å—Å':'–î–æ–±–∞–≤–∏—Ç—å –†–∞—Å—Ö–æ–¥'; document.getElementById('tableTitle').innerText = isI?'–î–æ—Ö–æ–¥—ã':'–†–∞—Å—Ö–æ–¥—ã'; }
      function calcTotal() { document.getElementById('txtTotal').innerText = ((parseFloat(document.getElementById('inpPrice').value)||0)*(parseFloat(document.getElementById('inpQty').value)||0)).toLocaleString() + ' ‚ÇΩ'; }
      function modVal(id, d) { const e=document.getElementById(id); e.value=Math.max(1, (parseFloat(e.value)||0)+d); calcTotal(); }
      function showSearch(e) { /* Simplified search logic here */ }
      function openDel(id) { deleteTargetId = id; document.getElementById('deleteModal').style.display='flex'; }
      function confirmDelete() { 
          document.getElementById('deleteModal').style.display='none';
          runBackend('deleteTransaction', {rowId: deleteTargetId, type: currTab}).then(r => { showToast("–£–¥–∞–ª–µ–Ω–æ"); refreshTable(true); loadAnalytics(); });
      }
      function showToast(m, err) { const t=document.getElementById('toast'); t.innerText=m; t.className=err?'toast show error':'toast show'; setTimeout(()=>t.className='toast', 3000); }
      function toggleTheme() { document.body.dataset.theme = document.body.dataset.theme==='dark'?'light':'dark'; }
    </script>
</body>
</html>
