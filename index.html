<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Venus Workshop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      :root { 
        --bg-app: #F2F2F7;
        --bg-panel: #FFFFFF;      
        --text-main: #1C1C1E;     
        --text-sub: #8E8E93;      
        --accent: #007AFF;        
        --border: rgba(0,0,0,0.08); 
        --border-strong: #C7C7CC;
        --input-bg: #F2F2F7;      
        
        --color-inc: #34C759;
        --color-exp: #FF3B30;     
        --color-prof: #5856D6;    
        --color-vis: #AF52DE;
        
        --danger: #FF3B30;
        --shadow-card: 0 4px 12px rgba(0,0,0,0.06);
        --radius: 20px;
      }
      
      [data-theme="dark"] { 
        --bg-app: #0f172a;
        --bg-panel: #1e293b; 
        --text-main: #f8fafc;     
        --text-sub: #94a3b8;      
        --accent: #60a5fa;        
        --border: #334155;        
        --border-strong: #475569;
        --input-bg: #0f172a;      
        
        --shadow-card: 0 4px 20px rgba(0,0,0,0.4);
        --color-inc: #4ade80;     
        --color-exp: #f87171;     
        --color-prof: #818cf8;    
        --color-vis: #c084fc;     
      }
      
      * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
      
      body { 
          margin: 0; padding: 20px; 
          font-family: 'Inter', sans-serif; 
          background-color: var(--bg-app); color: var(--text-main); 
          height: 100vh; height: 100dvh; 
          overflow: hidden; 
          display:flex; flex-direction:column;
          -webkit-font-smoothing: antialiased; font-weight: 500;
          user-select: none;
      }
      
      /* HEADER */
      .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-shrink: 0; position: relative; z-index: 10; }
      .brand-box { display: flex; align-items: center; gap: 12px; }
      .title { margin: 0; font-size: 24px; font-weight: 800; letter-spacing: -0.5px; }
      .venus-icon { width: 42px; height: 42px; cursor: pointer; transition: transform 0.5s ease; position: relative; z-index: 5; }
      .venus-icon:active { transform: scale(0.9); }
      .venus-icon.spinning { animation: spinInfinite 1.5s linear infinite; }
      @keyframes spinInfinite { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

      /* PAGE SLIDER CONTAINER */
      .viewport { flex: 1; position: relative; overflow: hidden; width: 100%; border-radius: var(--radius); }
      .pages-container { display: flex; width: 300%; height: 100%; transition: transform 0.35s cubic-bezier(0.2, 0.8, 0.2, 1); will-change: transform; }
      .tab-page { width: 33.333%; height: 100%; overflow-y: auto; padding-bottom: 80px; position: relative; }

      /* UI ELEMENTS */
      .split-view { display: flex; height: 100%; gap: 20px; padding: 0 5px; } 
      .panel { background: var(--bg-panel); border-radius: var(--radius); box-shadow: var(--shadow-card); overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--border); }
      .panel-left { width: 360px; padding: 30px; flex-shrink: 0; overflow-y: auto; }
      .panel-right { flex: 1; overflow: hidden; display: flex; flex-direction: column;}
      
      h3 { margin-top: 0; font-size: 18px; font-weight: 700; margin-bottom: 20px; }
      label { font-size: 12px; font-weight: 700; color: var(--text-sub); margin-bottom: 8px; display: block; letter-spacing: 0.02em; }
      
      input, select, .custom-select-trigger { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border-strong); background-color: var(--input-bg); color: var(--text-main); font-size: 15px; outline:none; transition:0.2s; font-weight: 600; font-family: 'Inter', sans-serif; }
      input:focus { border-color: var(--accent); background: var(--bg-panel); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1); }
      
      .qty-wrapper { display: flex; align-items: center; background: var(--input-bg); border: 1px solid var(--border-strong); border-radius: 12px; overflow: hidden; padding: 2px; }
      .qty-btn { width: 44px; height: 44px; background: transparent; border: none; color: var(--text-main); font-size: 20px; cursor: pointer; border-radius: 10px; transition: 0.2s; font-weight: 600; }
      .qty-input { text-align: center; border: none; font-weight: 700; font-size: 18px; flex: 1; padding: 0; background: transparent; -moz-appearance: textfield; }
      .qty-input::-webkit-outer-spin-button, .qty-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

      .btn { width: 100%; padding: 18px; background: var(--accent); color: white; border: none; border-radius: 16px; font-weight: 700; cursor: pointer; margin-top: 20px; font-size: 16px; transition: 0.2s; }
      .btn:active { transform: scale(0.98); opacity: 0.9; }
      .shake { animation: shakeAnim 0.4s cubic-bezier(.36,.07,.19,.97) both; }
      @keyframes shakeAnim { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

      /* LIST & CARDS (2-row layout) */
      .list-container { flex: 1; overflow-y: auto; padding: 10px 20px 20px 20px; -webkit-overflow-scrolling: touch; }
      .record-card { 
          background: var(--input-bg); border: 1px solid var(--border); 
          border-radius: 16px; padding: 12px 16px; margin-bottom: 10px;
          display: flex; flex-direction: column; gap: 8px;
          transition: transform 0.1s;
      }
      .record-card:active { transform: scale(0.98); }
      .rc-top { display: flex; justify-content: space-between; align-items: center; }
      .rc-date { font-size: 11px; color: var(--text-sub); font-weight: 600; text-transform: uppercase;}
      .rc-name { font-size: 15px; font-weight: 600; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 65%; }
      .rc-bot { display: flex; justify-content: space-between; align-items: center; border-top: 1px dashed var(--border-strong); padding-top: 8px; }
      .rc-sum { font-size: 16px; font-weight: 800; color: var(--text-main); }
      .rc-actions { display: flex; gap: 8px; }
      .btn-mini { width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--border-strong); background: transparent; color: var(--text-sub); display: flex; align-items: center; justify-content: center; cursor: pointer; }

      /* ANALYTICS */
      .analytics-container { padding: 0 10px 100px 10px; overflow-y: auto; height: 100%; box-sizing: border-box; }
      .kpi-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
      .kpi-card { background: var(--bg-panel); padding: 20px; border-radius: 20px; box-shadow: var(--shadow-card); border: 1px solid var(--border); }
      .kpi-title { font-size: 10px; color: var(--text-sub); text-transform: uppercase; font-weight: 700; margin-bottom: 6px; }
      .kpi-val { font-size: 24px; font-weight: 800; letter-spacing: -1px; }
      .kpi-trend { font-size: 12px; font-weight: 700; margin-top: 4px; display: inline-block; padding: 2px 8px; border-radius: 12px; }
      .trend-up { background: rgba(52, 199, 89, 0.15); color: var(--color-inc); }
      .trend-down { background: rgba(255, 59, 48, 0.15); color: var(--color-exp); }
      
      .charts-stack { display: flex; flex-direction: column; gap: 20px; }
      .chart-box { width: 100%; min-height: 280px; background: var(--bg-panel); border-radius: 24px; padding: 20px; box-shadow: var(--shadow-card); border: 1px solid var(--border); display: flex; flex-direction: column; }
      .chart-head { font-weight: 700; font-size: 16px; margin-bottom: 10px; }
      .chart-canv { flex: 1; position: relative; min-height: 200px; }

      /* NAVIGATION */
      .nav { display: flex; background: var(--bg-panel); padding: 4px; border-radius: 14px; margin-bottom: 20px; flex-shrink: 0; box-shadow: var(--shadow-card); border: 1px solid var(--border); position: relative; z-index: 10; }
      .nav-btn { flex: 1; padding: 10px; border: none; background: transparent; color: var(--text-sub); border-radius: 10px; cursor: pointer; font-weight: 600; text-align: center; transition: 0.2s; font-size: 14px; z-index: 2; position: relative; display: flex; align-items: center; justify-content: center; gap:8px;}
      .nav-btn.active { color: var(--text-main); background: var(--bg-app); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
      [data-theme="dark"] .nav-btn.active { background: #334155; box-shadow: none; }
      .nav-btn svg { width: 18px; height: 18px; fill: currentColor; opacity: 0.7; }
      .nav-btn.active svg { opacity: 1; color: var(--accent); fill: var(--accent); }
      .nav-indicator { display: none; }

      /* WHEEL PICKER (DRUM) */
      .picker-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 3000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
      .picker-box { width: 300px; background: var(--bg-panel); border-radius: 24px; padding: 25px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; flex-direction: column; align-items: center; }
      .picker-title { font-weight: 800; margin-bottom: 20px; color: var(--text-main); font-size: 18px; text-align: center; }
      .wheel-container { width: 100%; height: 200px; position: relative; overflow: hidden; mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent); -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent); touch-action: none; }
      .wheel-highlight { position: absolute; top: 50%; left: 0; width: 100%; height: 44px; transform: translateY(-50%); border-top: 1px solid var(--accent); border-bottom: 1px solid var(--accent); background: rgba(var(--accent), 0.05); pointer-events: none; z-index: 0; border-radius: 8px; }
      .wheel-scroller { list-style: none; padding: 0; margin: 0; transform-style: preserve-3d; }
      .wheel-item { height: 44px; display: flex; align-items: center; justify-content: center; font-size: 17px; font-weight: 500; color: var(--text-sub); transition: transform 0.1s, opacity 0.1s, color 0.1s; cursor: pointer; }
      .wheel-item.active { color: var(--text-main); font-weight: 800; transform: scale(1.15); opacity: 1; }

      /* MODALS */
      .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
      .modal-box { background: var(--bg-panel); padding: 25px; border-radius: 24px; width: 320px; border: 1px solid var(--border); box-shadow: 0 20px 60px rgba(0,0,0,0.3); transform: scale(0.95); animation: popIn 0.2s forwards; }
      
      .search-wrap { position: relative; margin-bottom: 15px; }
      .search-res { position: absolute; top: 100%; left: 0; width: 100%; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 14px; z-index: 100; max-height: 200px; overflow-y: auto; display: none; margin-top: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
      .res-item { padding: 14px 20px; border-bottom: 1px solid var(--border); font-size: 15px; font-weight: 600; }

      @keyframes popIn { to { transform: scale(1); } }
      .loader { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.01); z-index:50; display:none; }
      .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 24px; border-radius: 12px; opacity: 0; transition: 0.3s; z-index: 3000; font-size: 14px; font-weight: 600; box-shadow: 0 10px 20px rgba(0,0,0,0.2); pointer-events: none; }
      .toast.show { opacity: 1; transform: translate(-50%, -10px); }
      .toast.error { background: var(--danger); }

      /* MOBILE ADAPT */
      @media (max-width: 768px) {
        body { padding: 0; }
        .header { padding: 10px 20px 0 20px; margin-bottom: 10px; }
        .split-view { flex-direction: column; gap: 15px; }
        .panel { border-radius: 24px; border: none; box-shadow: none; background: transparent; }
        .panel-left { width: 100%; padding: 0 20px; overflow: visible; }
        .panel-right { min-height: 300px; padding: 0 5px; }
        .list-container { padding: 0 20px 100px 20px; overflow: visible; }
        
        .nav { position: fixed; bottom: 20px; left: 20px; right: 20px; margin: 0; border-radius: 24px; background: var(--bg-panel); box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 1000; display: grid; grid-template-columns: 1fr 1fr 1fr; padding: 5px; height: 65px; border: 1px solid var(--border); }
        .nav-indicator { display: block; position: absolute; top: 5px; left: 5px; height: calc(100% - 10px); width: calc((100% - 10px) / 3); background: var(--bg-app); border-radius: 20px; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 1; pointer-events: none; }
        [data-theme="dark"] .nav-indicator { background: #334155; }
        .nav-btn { background: transparent !important; box-shadow: none !important; flex-direction: column; gap: 4px; font-size: 10px; color: var(--text-sub); transition: color 0.2s; z-index: 10; width: 100%; }
        .nav-btn svg { width: 22px; height: 22px; margin-bottom: 2px; transition: transform 0.2s; }
        .nav-btn.active { color: var(--accent); }
        .nav-btn.active svg { transform: translateY(-2px); fill: var(--accent); }
      }
    </style>
</head>
<body data-theme="light">

    <div id="toast" class="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
    <div id="loader" class="loader"></div>

    <div class="header">
        <div class="brand-box">
            <svg id="venus" onclick="toggleTheme(event)" class="venus-icon" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="48" fill="url(#venusGrad)" />
                <path d="M10 50C10 50 30 40 50 40C70 40 90 50 90 50" stroke="rgba(255,255,255,0.3)" stroke-width="4"/>
                <path d="M15 30C15 30 35 25 50 25C65 25 85 30 85 30" stroke="rgba(255,255,255,0.2)" stroke-width="3"/>
                <path d="M15 70C15 70 35 75 50 75C65 75 85 70 85 70" stroke="rgba(255,255,255,0.2)" stroke-width="3"/>
                <circle cx="70" cy="30" r="8" fill="rgba(0,0,0,0.1)"/>
                <circle cx="30" cy="65" r="5" fill="rgba(0,0,0,0.1)"/>
                <defs>
                    <radialGradient id="venusGrad" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(30 30) rotate(0) scale(70)">
                        <stop stop-color="#FFD700"/>
                        <stop offset="1" stop-color="#FF8C00"/>
                    </radialGradient>
                </defs>
            </svg>
            <div class="title">–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –í–µ–Ω–µ—Ä–∞</div>
        </div>
    </div>

    <div class="viewport" id="mainTouchArea">
        <div class="pages-container" id="pagesContainer">
            
            <div class="tab-page" id="page-income">
                <div class="split-view">
                    <div class="panel panel-left">
                        <h3>–î–æ–±–∞–≤–∏—Ç—å –î–æ—Ö–æ–¥</h3>
                        <div class="search-wrap">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ú–ö</label>
                            <input type="text" id="inpNameInc" placeholder="–ü–æ–∏—Å–∫ –∏–ª–∏ –Ω–æ–≤–æ–µ..." autocomplete="off" oninput="handleSearch(event, 'income')">
                            <div class="search-res" id="resInc"></div>
                        </div>
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <div style="flex:1"><label>–¶–µ–Ω–∞</label><div class="qty-wrapper"><button class="qty-btn" onclick="modVal('priceInc',-100)">‚àí</button><input type="number" id="priceInc" class="qty-input" placeholder="0" oninput="calcTotal('income')"><button class="qty-btn" onclick="modVal('priceInc',100)">+</button></div></div>
                            <div style="flex:1"><label>–ö–æ–ª-–≤–æ</label><div class="qty-wrapper"><button class="qty-btn" onclick="modVal('qtyInc',-1)">‚àí</button><input type="number" id="qtyInc" class="qty-input" value="1" oninput="calcTotal('income')"><button class="qty-btn" onclick="modVal('qtyInc',1)">+</button></div></div>
                        </div>
                        <div style="text-align:center; margin-top:20px; padding:15px; background:var(--bg-panel); border-radius:20px; border:1px solid var(--border); box-shadow:var(--shadow-card);">
                            <span style="font-size:10px; color:var(--text-sub); text-transform:uppercase; font-weight:700;">–ò—Ç–æ–≥–æ</span>
                            <div id="totalInc" style="font-size:28px; font-weight:800; color:var(--text-main)">0 ‚ÇΩ</div>
                        </div>
                        <button id="btnAddInc" class="btn" onclick="submitEntry('income')">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                    </div>
                    <div class="panel panel-right">
                        <div style="padding:20px 20px 10px 20px; display:flex; justify-content:space-between;"><h3 style="margin:0">–ü–æ—Å–ª–µ–¥–Ω–∏–µ</h3><button style="background:none; border:none; color:var(--accent); font-weight:600;" onclick="refreshTable('income', true)">–û–±–Ω–æ–≤–∏—Ç—å</button></div>
                        <div class="list-container" id="listIncome"></div>
                    </div>
                </div>
            </div>

            <div class="tab-page" id="page-expense">
                 <div class="split-view">
                    <div class="panel panel-left">
                        <h3>–î–æ–±–∞–≤–∏—Ç—å –†–∞—Å—Ö–æ–¥</h3>
                        <div class="search-wrap">
                            <label>–ú–∞—Ç–µ—Ä–∏–∞–ª</label>
                            <input type="text" id="inpNameExp" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ..." autocomplete="off" oninput="handleSearch(event, 'expense')">
                            <div class="search-res" id="resExp"></div>
                        </div>
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <div style="flex:1"><label>–¶–µ–Ω–∞</label><div class="qty-wrapper"><button class="qty-btn" onclick="modVal('priceExp',-100)">‚àí</button><input type="number" id="priceExp" class="qty-input" placeholder="0" oninput="calcTotal('expense')"><button class="qty-btn" onclick="modVal('priceExp',100)">+</button></div></div>
                            <div style="flex:1"><label>–ö–æ–ª-–≤–æ</label><div class="qty-wrapper"><button class="qty-btn" onclick="modVal('qtyExp',-1)">‚àí</button><input type="number" id="qtyExp" class="qty-input" value="1" oninput="calcTotal('expense')"><button class="qty-btn" onclick="modVal('qtyExp',1)">+</button></div></div>
                        </div>
                         <div style="text-align:center; margin-top:20px; padding:15px; background:var(--bg-panel); border-radius:20px; border:1px solid var(--border); box-shadow:var(--shadow-card);">
                            <span style="font-size:10px; color:var(--text-sub); text-transform:uppercase; font-weight:700;">–ò—Ç–æ–≥–æ</span>
                            <div id="totalExp" style="font-size:28px; font-weight:800; color:var(--text-main)">0 ‚ÇΩ</div>
                        </div>
                        <button id="btnAddExp" class="btn" onclick="submitEntry('expense')">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                    </div>
                    <div class="panel panel-right">
                        <div style="padding:20px 20px 10px 20px; display:flex; justify-content:space-between;"><h3 style="margin:0">–ü–æ—Å–ª–µ–¥–Ω–∏–µ</h3><button style="background:none; border:none; color:var(--accent); font-weight:600;" onclick="refreshTable('expense', true)">–û–±–Ω–æ–≤–∏—Ç—å</button></div>
                        <div class="list-container" id="listExpense"></div>
                    </div>
                </div>
            </div>

            <div class="tab-page" id="page-analytics">
                <div class="analytics-container">
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <div class="custom-select-wrapper" style="flex:1" onclick="openPicker('year')">
                            <div class="custom-select-trigger"><span id="txtYear">–ì–æ–¥</span></div>
                        </div>
                        <div class="custom-select-wrapper" style="flex:1" onclick="openPicker('month')">
                            <div class="custom-select-trigger"><span id="txtMonth">–ú–µ—Å—è—Ü</span></div>
                        </div>
                    </div>

                    <div class="kpi-grid">
                        <div class="kpi-card"><div class="kpi-title">–í–´–†–£–ß–ö–ê</div><div class="kpi-val" style="color:var(--color-inc)" id="kpiInc">0</div><div id="trendInc"></div></div>
                        <div class="kpi-card"><div class="kpi-title">–†–ê–°–•–û–î–´</div><div class="kpi-val" style="color:var(--color-exp)" id="kpiExp">0</div><div id="trendExp"></div></div>
                        <div class="kpi-card"><div class="kpi-title">–ü–†–ò–ë–´–õ–¨</div><div class="kpi-val" style="color:var(--color-prof)" id="kpiProf">0</div><div id="trendProf"></div></div>
                        <div class="kpi-card"><div class="kpi-title">–ü–û–°–ï–¢–ò–¢–ï–õ–ò</div><div class="kpi-val" style="color:var(--color-vis)" id="kpiVis">0</div><div id="trendVis"></div></div>
                    </div>

                    <div class="charts-stack">
                        <div class="chart-box"><div class="chart-head">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ü—É–ª—å—Å</div><div class="chart-canv"><canvas id="chartPulse"></canvas></div></div>
                        <div class="chart-box"><div class="chart-head">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</div><div class="chart-canv"><canvas id="chartAttendance"></canvas></div></div>
                        <div class="chart-box"><div class="chart-head">–¢–æ–ø –î–æ—Ö–æ–¥–æ–≤</div><div id="listIncPie" class="prog-list" style="overflow-y:auto"></div></div>
                        <div class="chart-box"><div class="chart-head">–¢–æ–ø –†–∞—Å—Ö–æ–¥–æ–≤</div><div id="listExpPie" class="prog-list" style="overflow-y:auto"></div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="nav">
        <div class="nav-indicator" id="navInd"></div>
        <button class="nav-btn active" onclick="goToPage(0)">
            <svg viewBox="0 0 24 24"><path d="M21 18V19C21 20.1 20.1 21 19 21H5C3.89 21 3 20.1 3 19V5C3 3.9 3.89 3 5 3H19C20.1 3 21 3.9 21 5V6H12C10.89 6 10 6.9 10 8V16C10 17.1 10.89 18 12 18H21ZM12 16H22V8H12V16ZM16 13.5C15.17 13.5 14.5 12.83 14.5 12C14.5 11.17 15.17 10.5 16 10.5C16.83 10.5 17.5 11.17 17.5 12C17.5 12.83 16.83 13.5 16 13.5Z"/></svg>
            –ú–ö
        </button>
        <button class="nav-btn" onclick="goToPage(1)">
            <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
            –†–∞—Å—Ö–æ–¥
        </button>
        <button class="nav-btn" onclick="goToPage(2)">
            <svg viewBox="0 0 24 24"><path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM9 17H7V10H9V17ZM13 17H11V7H13V17ZM17 17H15V13H17V17Z"/></svg>
            –ò–Ω—Ñ–æ
        </button>
    </div>

    <div id="pickerOverlay" class="picker-overlay" onclick="closePicker()">
        <div class="picker-box" onclick="event.stopPropagation()">
            <div class="picker-title" id="pickerTitle">–í—ã–±–µ—Ä–∏—Ç–µ</div>
            <div class="wheel-container" id="wheelCont">
                <div class="wheel-highlight"></div>
                <div class="wheel-scroller" id="wheelScroller"></div>
            </div>
            <button class="btn" style="margin-top:20px; padding:12px;" onclick="confirmPicker()">–í—ã–±—Ä–∞—Ç—å</button>
        </div>
    </div>

    <div id="editModal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-bottom:20px; color:var(--text-main)">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
            <input type="hidden" id="editId"><input type="hidden" id="editType">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="editName" style="margin-bottom:15px;">
            <div style="display:flex; gap:15px; margin-bottom:20px;">
                <div style="flex:1"><label>–¶–µ–Ω–∞</label><input type="number" id="editPrice"></div>
                <div style="flex:1"><label>–ö–æ–ª-–≤–æ</label><input type="number" id="editQty"></div>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn" onclick="saveEdit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn" style="background:var(--input-bg); color:var(--text-main); border:1px solid var(--border-strong);" onclick="document.getElementById('editModal').style.display='none'">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="deleteModal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-bottom:15px; color:var(--text-main)">–£–¥–∞–ª–µ–Ω–∏–µ</h3>
            <p style="color:var(--text-sub); margin-bottom:25px; font-size:14px; line-height:1.5;">–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ?</p>
            <div style="display:flex; gap:10px;">
                <button class="btn" style="background:var(--danger); color:white; margin-top:0;" onclick="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn" style="background:var(--input-bg); color:var(--text-main); border:1px solid var(--border-strong); margin-top:0;" onclick="document.getElementById('deleteModal').style.display='none'">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        // üëá –í–°–¢–ê–í–¨–¢–ï –°–°–´–õ–ö–£ –ò–ó GOOGLE SCRIPT DEPLOY –ó–î–ï–°–¨ üëá
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbymyQBfqV_3paY89BmTvPVSp0INVudzeyTD4Eth-v4qsD_PfHJ8LrbqDbt2YcUjJryE/exec';
        // üëÜüëÜüëÜ

        const IS_GOOGLE = typeof google !== 'undefined' && google.script && google.script.run;
        const tg = window.Telegram.WebApp;
        let currPageIdx = 0;
        let config = { incomeItems: [], expenseItems: [] };
        let dataCache = { income: null, expense: null };
        let charts = {};
        let selYear = new Date().getFullYear(), selMonth = new Date().getMonth();
        let availableYears = [];
        const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];

        // HAPTICS HELPER
        function haptic(type) {
            if (!tg.HapticFeedback) return;
            if(type==='light') tg.HapticFeedback.impactOccurred('light');
            else if(type==='medium') tg.HapticFeedback.impactOccurred('medium');
            else if(type==='heavy') tg.HapticFeedback.impactOccurred('heavy');
            else if(type==='err') tg.HapticFeedback.notificationOccurred('error');
            else if(type==='success') tg.HapticFeedback.notificationOccurred('success');
            else if(type==='sel') tg.HapticFeedback.selectionChanged();
        }

        // --- BACKEND CONNECTION FIX ---
        async function runBackend(action, payload = {}) {
            if (IS_GOOGLE) {
                return new Promise((resolve, reject) => {
                    if(action === 'getInitialConfig') google.script.run.withSuccessHandler(resolve).getInitialConfig();
                    else if(action === 'saveTransaction') google.script.run.withSuccessHandler(resolve).saveTransaction(payload);
                    else if(action === 'getTableData') google.script.run.withSuccessHandler(resolve).getTableData(payload.type);
                    else if(action === 'editTransaction') google.script.run.withSuccessHandler(resolve).editTransaction(payload);
                    else if(action === 'deleteTransaction') google.script.run.withSuccessHandler(resolve).deleteTransaction(payload);
                    else if(action === 'getAnalyticsData') google.script.run.withSuccessHandler(resolve).getAnalyticsData(payload.year, payload.monthIdx);
                });
            } else {
                // FIXED FETCH LOGIC FOR TELEGRAM/GITHUB
                payload.action = action;
                try {
                    const res = await fetch(GAS_URL, {
                        method: "POST",
                        headers: { "Content-Type": "text/plain;charset=utf-8" },
                        body: JSON.stringify(payload)
                    });
                    const text = await res.text();
                    try { return JSON.parse(text); } catch(e) { throw new Error("Server Error: " + text); }
                } catch(e) { throw e; }
            }
        }

        // INIT
        window.onload = function() {
            if(tg) tg.expand();
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            
            setLoading(true);
            runBackend('getInitialConfig').then(res => {
                config = res; availableYears = res.years;
                updateFilterUI(); 
                refreshTable('income', true);
                setLoading(false);
            }).catch(e => {
                showToast("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: " + e, true);
                setLoading(false);
            });

            const v = document.getElementById('venus');
            v.addEventListener('animationiteration', () => { if(stopAnim) { v.classList.remove('spinning'); stopAnim=false; } });
            setupSwipes();
        };

        let stopAnim = false, reqs = 0;
        function setLoading(active) {
            const v = document.getElementById('venus');
            if (active) { reqs++; stopAnim=false; v.classList.add('spinning'); } 
            else { reqs--; if(reqs<=0) { reqs=0; stopAnim=true; } }
        }

        // --- NAVIGATION ---
        function goToPage(idx) {
            if(idx === currPageIdx) return;
            haptic('medium'); // Vibrate on tab switch
            currPageIdx = idx;
            const container = document.getElementById('pagesContainer');
            container.style.transform = `translateX(-${idx * 33.333}%)`;
            
            const btns = document.querySelectorAll('.nav-btn');
            btns.forEach(b => b.classList.remove('active'));
            btns[idx].classList.add('active');
            document.getElementById('navInd').style.transform = `translateX(${idx * 100}%)`;
            
            if(idx === 1 && !dataCache.expense) refreshTable('expense');
            if(idx === 2) loadAnalytics();
        }

        function setupSwipes() {
            let startX = 0, startY = 0;
            const zone = document.getElementById('mainTouchArea');
            zone.addEventListener('touchstart', e => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; }, {passive:true});
            zone.addEventListener('touchend', e => {
                const diffX = e.changedTouches[0].clientX - startX;
                const diffY = e.changedTouches[0].clientY - startY;
                if(Math.abs(diffX) > 80 && Math.abs(diffX) > Math.abs(diffY) * 1.5) {
                    if(diffX < 0 && currPageIdx < 2) goToPage(currPageIdx+1);
                    if(diffX > 0 && currPageIdx > 0) goToPage(currPageIdx-1);
                }
            }, {passive:true});
        }
        
        function toggleTheme(e) {
            haptic('light');
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';
            if (!document.startViewTransition) { setTheme(newTheme); return; }
            const rect = document.getElementById('venus').getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            const endRadius = Math.hypot(Math.max(x, innerWidth - x), Math.max(y, innerHeight - y));
            document.startViewTransition(() => setTheme(newTheme));
            document.documentElement.animate({ clipPath: [`circle(0px at ${x}px ${y}px)`, `circle(${endRadius}px at ${x}px ${y}px)`] }, { duration: 600, easing: 'ease-in', pseudoElement: '::view-transition-new(root)' });
        }
        function setTheme(t) { document.body.setAttribute('data-theme', t); localStorage.setItem('theme', t); if(currPageIdx===2) loadAnalytics(); }

        // --- WHEEL PICKER (DRUM) LOGIC ---
        let pickerType = null;
        let wheelItems = [];
        function openPicker(type) {
            haptic('light');
            pickerType = type;
            document.getElementById('pickerOverlay').style.display = 'flex';
            document.getElementById('pickerTitle').innerText = type === 'year' ? '–í—ã–±–µ—Ä–∏—Ç–µ –ì–æ–¥' : '–í—ã–±–µ—Ä–∏—Ç–µ –ú–µ—Å—è—Ü';
            
            const scroller = document.getElementById('wheelScroller');
            scroller.innerHTML = '';
            
            let items = [];
            if(type === 'year') items = availableYears.map(y => ({ val: y, label: y }));
            else {
                items.push({val:'all', label:'–í–µ—Å—å –≥–æ–¥'});
                monthNames.forEach((m,i) => items.push({val:i, label:m}));
            }
            
            scroller.innerHTML += '<div style="height:80px"></div>'; // Padding top
            items.forEach((item, idx) => {
                const el = document.createElement('div');
                el.className = 'wheel-item';
                el.innerText = item.label;
                el.dataset.val = item.val;
                el.onclick = () => scrollToItem(idx);
                scroller.appendChild(el);
            });
            scroller.innerHTML += '<div style="height:80px"></div>'; // Padding bottom
            
            wheelItems = Array.from(document.querySelectorAll('.wheel-item'));
            
            let currentVal = type === 'year' ? selYear : selMonth;
            let targetIdx = items.findIndex(i => i.val == currentVal);
            if(targetIdx < 0) targetIdx = 0;
            
            setTimeout(() => {
                scroller.scrollTop = targetIdx * 44; 
                highlightWheel();
                scroller.addEventListener('scroll', onWheelScroll);
            }, 10);
        }
        
        function scrollToItem(idx) {
            const scroller = document.getElementById('wheelScroller');
            scroller.scrollTo({ top: idx * 44, behavior: 'smooth' });
        }

        let wheelTimeout;
        let lastScrollIdx = -1;
        function onWheelScroll() {
            const scroller = document.getElementById('wheelScroller');
            const idx = Math.round(scroller.scrollTop / 44);
            
            if(idx !== lastScrollIdx) {
                haptic('sel'); // TICK VIBRATION
                lastScrollIdx = idx;
            }
            
            wheelItems.forEach((el, i) => {
                if(i === idx) el.classList.add('active');
                else el.classList.remove('active');
            });
            
            clearTimeout(wheelTimeout);
            wheelTimeout = setTimeout(() => {
                scroller.scrollTo({ top: idx * 44, behavior: 'smooth' });
            }, 150);
        }

        function highlightWheel() {
            const scroller = document.getElementById('wheelScroller');
            const idx = Math.round(scroller.scrollTop / 44);
            wheelItems.forEach((el, i) => i === idx ? el.classList.add('active') : el.classList.remove('active'));
        }

        function closePicker() { document.getElementById('pickerOverlay').style.display = 'none'; document.getElementById('wheelScroller').removeEventListener('scroll', onWheelScroll); }
        function confirmPicker() {
            haptic('success');
            const active = document.querySelector('.wheel-item.active');
            if(active) {
                const val = active.dataset.val;
                if(pickerType === 'year') selYear = parseInt(val);
                else selMonth = val === 'all' ? 'all' : parseInt(val);
                updateFilterUI(); loadAnalytics();
            }
            closePicker();
        }

        function updateFilterUI() {
            document.getElementById('txtYear').innerText = selYear;
            document.getElementById('txtMonth').innerText = (selMonth === 'all') ? '–í–µ—Å—å –≥–æ–¥' : monthNames[selMonth];
        }

        // --- DATA & TABLES ---
        function refreshTable(type, force=false) {
            if(!force && dataCache[type]) return;
            const list = document.getElementById(type==='income'?'listIncome':'listExpense');
            list.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text-sub)">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            runBackend('getTableData', {type}).then(data => {
                dataCache[type] = data; renderList(type, data);
            });
        }
        
        function renderList(type, data) {
            const list = document.getElementById(type==='income'?'listIncome':'listExpense');
            list.innerHTML = '';
            if(!data || !data.length) { list.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text-sub)">–ü—É—Å—Ç–æ</div>'; return; }
            data.forEach(row => {
                const div = document.createElement('div');
                div.className = 'record-card';
                div.id = `row-${row.rowId}`;
                const shortDate = row.dateStr.length >= 10 ? row.dateStr.slice(0, 6) : row.dateStr;
                const rowJson = JSON.stringify(row).replace(/"/g, '&quot;');
                div.innerHTML = `<div class="rc-top"><span class="rc-date">${shortDate}</span><span class="rc-name">${row.name}</span></div><div class="rc-bot"><span class="rc-sum">${row.total.toLocaleString()} ‚ÇΩ</span><div class="rc-actions"><button class="btn-mini btn-edit" onclick="openEdit(${rowJson}, '${type}')"><svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg></button><button class="btn-mini btn-del" onclick="openDel(${rowJson}, '${type}')"><svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button></div></div>`;
                list.appendChild(div);
            });
        }

        // --- FORMS ---
        function submitEntry(type) {
            const sfx = type==='income'?'Inc':'Exp';
            const name = document.getElementById('inpName'+sfx).value.trim();
            const price = parseFloat(document.getElementById('price'+sfx).value);
            const qty = parseFloat(document.getElementById('qty'+sfx).value);
            const btn = document.getElementById('btnAdd'+sfx);
            
            if(!name || !price || isNaN(price)) { 
                haptic('err'); // ERROR VIBRATION
                btn.classList.add('shake'); setTimeout(()=>btn.classList.remove('shake'), 400); 
                return; 
            }
            haptic('success');
            
            const total = price * qty;
            const listItems = type === 'income' ? config.incomeItems : config.expenseItems;
            if(!listItems.includes(name)) listItems.push(name);
            
            // Add temp card
            const container = document.getElementById('list'+(type==='income'?'Income':'Expense'));
            const tmp = document.createElement('div'); tmp.className='record-card'; tmp.style.opacity='0.5';
            tmp.innerHTML = `<div class="rc-top"><span>–°–µ–≥–æ–¥–Ω—è</span><span>${name}</span></div><div class="rc-bot"><span>${total} ‚ÇΩ</span><span>...</span></div>`;
            container.prepend(tmp);

            // Clear inputs
            document.getElementById('inpName'+sfx).value=''; document.getElementById('price'+sfx).value=''; document.getElementById('qty'+sfx).value=1; calcTotal(type);
            
            runBackend('saveTransaction', {type, name, price, qty, total, isNew: !listItems.includes(name)}).then(res => {
                if(res.success) { showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ'); refreshTable(type, true); }
                else { tmp.remove(); showToast(res.message, true); }
            });
        }

        function openEdit(row, type) {
            haptic('heavy');
            document.getElementById('editId').value = row.rowId; document.getElementById('editType').value = type;
            document.getElementById('editName').value = row.name; document.getElementById('editPrice').value = row.price; document.getElementById('editQty').value = row.qty;
            document.getElementById('editModal').style.display = 'flex';
        }
        function saveEdit() {
            haptic('success');
            const id = document.getElementById('editId').value, type = document.getElementById('editType').value;
            const name = document.getElementById('editName').value, price = parseFloat(document.getElementById('editPrice').value), qty = parseFloat(document.getElementById('editQty').value);
            document.getElementById('editModal').style.display = 'none';
            setLoading(true);
            runBackend('editTransaction', {rowId:id, type, name, price, qty}).then(res => {
                setLoading(false);
                if(res.success) { showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'); refreshTable(type, true); } else showToast(res.message, true);
            });
        }
        let delId, delType;
        function openDel(row, type) { haptic('heavy'); delId = row.rowId; delType = type; document.getElementById('deleteModal').style.display = 'flex'; }
        function confirmDelete() {
            haptic('heavy');
            document.getElementById('deleteModal').style.display = 'none';
            const el = document.getElementById('row-'+delId); if(el) el.style.opacity='0';
            runBackend('deleteTransaction', {rowId:delId, type:delType}).then(res => {
                if(res.success) { showToast('–£–¥–∞–ª–µ–Ω–æ'); refreshTable(delType, true); } else showToast(res.message, true);
            });
        }

        // --- ANALYTICS ---
        function loadAnalytics() {
            setLoading(true);
            runBackend('getAnalyticsData', {year: selYear, monthIdx: selMonth}).then(d => {
                setLoading(false);
                renderKPI('kpiInc', d.current.income, d.growth.income, 'trend-up');
                renderKPI('kpiExp', d.current.expense, d.growth.expense, 'trend-down');
                renderKPI('kpiProf', d.current.profit, d.growth.profit, 'trend-up');
                renderKPI('kpiVis', d.current.visitors, d.growth.visitors, 'trend-up');
                
                renderChart('chartPulse', d.pulse.labels, [{label:'Inc', data:d.pulse.income, borderColor:'#34C759', bg:'rgba(52,199,89,0.1)'}, {label:'Exp', data:d.pulse.expense, borderColor:'#FF3B30', bg:'rgba(255,59,48,0.1)'}]);
                renderChart('chartAttendance', d.attendance.labels, [{label:'Vis', data:d.attendance.data, borderColor:'#AF52DE', bg:'rgba(175,82,222,0.1)'}]);
                renderProg('listIncPie', d.pieIncome.labels, d.pieIncome.data, '#34C759');
                renderProg('listExpPie', d.pieExpense.labels, d.pieExpense.data, '#FF3B30');
            });
        }
        function renderKPI(id, val, gr, goodCls) {
            document.getElementById(id).innerText = val.toLocaleString();
            const tr = document.getElementById(id.replace('kpi','trend'));
            let cls = 'trend-up'; 
            if(id === 'kpiExp') cls = gr > 0 ? 'trend-down' : 'trend-up';
            else cls = gr >= 0 ? 'trend-up' : 'trend-down';
            tr.className = `kpi-trend ${cls}`; tr.innerText = `${gr>=0?'‚Üó':'‚Üò'} ${Math.abs(gr)}%`;
        }
        function renderChart(id, lbls, sets) {
            if(charts[id]) charts[id].destroy();
            charts[id] = new Chart(document.getElementById(id).getContext('2d'), {
                type: 'line',
                data: { labels: lbls, datasets: sets.map(s => ({label:s.label, data:s.data, borderColor:s.borderColor, backgroundColor:s.bg, borderWidth:2, fill:true, tension:0.4, pointRadius:0}))},
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{grid:{display:false}}, y:{display:false}} }
            });
        }
        function renderProg(id, lbls, data, col) {
            const el = document.getElementById(id); el.innerHTML = '';
            if(!data.length) { el.innerText='–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'; return; }
            const max = Math.max(...data);
            lbls.forEach((l, i) => {
                const pct = (data[i]/max)*100;
                el.insertAdjacentHTML('beforeend', `<div style="margin-bottom:8px"><div style="display:flex;justify-content:space-between;font-size:13px;font-weight:600"><span>${l}</span><span>${data[i].toLocaleString()}</span></div><div style="height:6px;background:var(--input-bg);border-radius:3px;margin-top:2px"><div style="width:${pct}%;height:100%;background:${col};border-radius:3px"></div></div></div>`);
            });
        }

        // --- UTILS ---
        function modVal(id, d) { 
            haptic('light'); // TICK ON +/-
            const el=document.getElementById(id); let v=parseFloat(el.value)||0; v+=d; if(v<0) v=0; if(id.includes('qty') && v<1) v=1; el.value=v; calcTotal(id.includes('Inc')?'income':'expense'); 
        }
        function calcTotal(type) {
            haptic('selection'); // TICK ON INPUT
            const sfx = type==='income'?'Inc':'Exp';
            const p = parseFloat(document.getElementById('price'+sfx).value)||0;
            const q = parseFloat(document.getElementById('qty'+sfx).value)||0;
            document.getElementById('total'+sfx).innerText = (p*q).toLocaleString() + ' ‚ÇΩ';
        }
        function handleSearch(e, type) {
            haptic('selection');
            const val = e.target.value.toLowerCase();
            const res = document.getElementById(type==='income'?'resInc':'resExp');
            res.innerHTML = ''; if(!val) { res.style.display='none'; return; }
            const list = type==='income' ? config.incomeItems : config.expenseItems;
            const matches = list.filter(x => x.toLowerCase().includes(val)).slice(0,5);
            if(matches.length) {
                res.style.display='block';
                matches.forEach(m => {
                    const d = document.createElement('div'); d.className='res-item'; d.innerText=m;
                    d.onclick = () => { haptic('light'); document.getElementById(type==='income'?'inpNameInc':'inpNameExp').value=m; res.style.display='none'; };
                    res.appendChild(d);
                });
            } else res.style.display='none';
        }
        function showToast(msg, err) { const t=document.getElementById('toast'); t.innerText=msg; t.className=err?'toast error show':'toast success show'; haptic(err?'err':'success'); setTimeout(()=>t.className='toast', 3000); }
    </script>
</body>
</html>
